
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>immanu10 - Two-Phase Commit</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <h1 id="logo">
            <a href="/blog">immanu10s blog</a>
            <span>*All blogs are generated by AI</span>
        </h1>
        <div>
            <a href="https://github.com/immanu10/" target="_blank">github</a>
            <a href="https://www.linkedin.com/in/immanu10" target="_blank">linkedin</a>
        </div>
    </nav>
    <main>

<div>
    <time>09-Feb-2025</time>
</div>
<h1>Two-Phase Commit</h1>
<br>
<div id="blog-content"><p>Two-Phase Commit (2PC) is a distributed consensus protocol used to ensure atomicity (all-or-nothing execution) of transactions spanning multiple database nodes.  Imagine updating balances across multiple accounts in a distributed banking system. 2PC ensures that either all updates succeed, or none do, preventing inconsistencies.</p>

<p>Here&rsquo;s a breakdown of the two phases:</p>

<p><strong>Phase 1: Prepare Phase</strong></p>

<ol>
<li><strong>Coordinator Selection:</strong> One node acts as the coordinator, leading the transaction.</li>
<li><strong>Prepare Request:</strong> The coordinator sends a &ldquo;prepare&rdquo; message to all participating nodes (participants).</li>
<li><strong>Participant Vote:</strong> Each participant performs all necessary actions to execute the transaction <em>locally</em> but does <em>not</em> commit yet.  If a participant can successfully prepare, it logs the transaction and sends a &ldquo;vote-commit&rdquo; message to the coordinator. If it cannot prepare (e.g., due to a constraint violation), it sends a &ldquo;vote-abort&rdquo; message.</li>
</ol>

<p><strong>Phase 2: Commit/Abort Phase</strong></p>

<ol>
<li><strong>Coordinator Decision:</strong>

<ul>
<li>If the coordinator receives &ldquo;vote-commit&rdquo; from <em>all</em> participants, it logs the commit operation and sends a &ldquo;commit&rdquo; message to all participants.</li>
<li>If the coordinator receives even one &ldquo;vote-abort&rdquo; or doesn&rsquo;t hear back from a participant within a timeout period, it decides to abort.  It logs the abort operation and sends an &ldquo;abort&rdquo; message to all participants.</li>
</ul></li>
<li><strong>Participant Action:</strong>

<ul>
<li>If a participant receives a &ldquo;commit&rdquo; message, it applies the previously prepared transaction and then releases any locks held.</li>
<li>If a participant receives an &ldquo;abort&rdquo; message, it undoes the prepared transaction and releases locks.</li>
</ul></li>
</ol>

<p><strong>Example (Conceptual JavaScript):</strong></p>

<pre><code class="language-javascript">// Coordinator
function coordinator(participants) {
  // Phase 1: Prepare
  const votes = await Promise.all(participants.map(p =&gt; p.prepare()));
  if (votes.every(vote =&gt; vote === 'vote-commit')) {
    // Phase 2: Commit
    await Promise.all(participants.map(p =&gt; p.commit()));
    console.log(&quot;Transaction committed&quot;);
  } else {
    // Phase 2: Abort
    await Promise.all(participants.map(p =&gt; p.abort()));
    console.log(&quot;Transaction aborted&quot;);
  }
}

// Participant
class Participant {
  async prepare() {
    // Perform local checks and prepare
    try {
      // ... local preparation ...
      return 'vote-commit';
    } catch (error) {
      return 'vote-abort';
    }
  }

  async commit() {
    // Commit the transaction
    // ... apply changes ...
  }

  async abort() {
    // Abort the transaction
    // ... rollback changes ...
  }
}


const participants = [new Participant(), new Participant(), new Participant()];
coordinator(participants);
</code></pre>

<p><strong>Limitations:</strong></p>

<ul>
<li><strong>Blocking:</strong>  2PC can cause blocking.  If the coordinator fails during phase 2, participants may be blocked indefinitely waiting for a commit/abort decision.</li>
<li><strong>Performance:</strong>  The two phases and the coordination overhead can impact performance.</li>
</ul>

<p>Despite its limitations, 2PC provides a strong guarantee of atomicity in distributed transactions and is used in various database systems.  More sophisticated protocols like Three-Phase Commit address some of 2PC&rsquo;s shortcomings but introduce their own complexities.</p>
</div>

    </main>
</body>
</html>
